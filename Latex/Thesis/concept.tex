\chapter{Koncepcja gry}
W projektowanej grze gracze steruj¹ czo³gami, mog¹ do siebie strzelaæ, a w czasie rozgrywki bêd¹ dostawali ulepszenia, wzmacniaj¹ce ich mo¿liwoœci bojowe, zarówno pasywne i aktywne.
W tym rozdziale szczwegó³owo opisane zostan¹ mechaniki gry oraz wymagania z dziedziny \emph{game designu}.

\section{Projekt mechanik}

Do zaimplementowania zaplanowane zosta³y nastêpuj¹ce mechaniki:

\begin{itemize}
    \item Sterowanie gracza,
    \item Strzelanie,
    \item System zdrowia/¿ycia,
    \item System rund,
    \item Karty ulepszeñ,
    \item Atrybuty pasywne i aktywne,
    \item \emph{User experience}.
\end{itemize}

Zostan¹ one szczegó³owo opisane w kolejnych sekcjach.
% Ponadto poni¿sze mechaniki opisano jako wymagania dodatkowe, nieobowi¹zkowe:

% \begin{itemize}
%     \item Zdolnoœci specjalne,
%     \item Zagro¿enia œrodowiskowe.
% \end{itemize}


\subsection{Sterowanie gracza}\label{sec:steering_concept}

W przypadku wiêkszoœci gier, w których gracz steruje pewn¹ postaci¹ (awatarem), istniej¹ za³o¿enia gracza zwi¹zane z tym jak takie sterowanie implementowane jest w innych produkcjach.
W projektowanej grze awatarem gracza jest czo³g, wykorzystany zostanie wiêc schemat sterowania zwany "sterowaniem czo³gowym" (ang. \emph{tank controls}). \cite{horror_tank_controls}
Poza potencjalnie intuicyjn¹ interpretacj¹ sterowania przez graczy, taki schemat charakteryzuje siê równie¿ przewidywalnym zachowaniem awatara w przypadku zmiany perspektywy kamery.

W tym schemacie sterowania awatar porusza siê w kierunku okreœlonym wzglêdem jego w³asnej orientacji, w przeciwieñstwie do wielu wspó³czesnych tytu³ów, w których postaæ porusza siê w kierunku wzglêdnym do kamery. [przygotowaæ schemat na rysunku]

Gra przygotowywana jest z myœl¹ o sterowaniu klawiatur¹ i mysz¹, schemat sterowania zostanie wiêc zmapowany na odpowiednie przyciski i gesty zwi¹zane z charakterystyk¹ tych urz¹dzeñ. [tabela ze schematem sterowania]

TODO: Tabelka z pe³nym schematem sterowania. - do rodzia³u z projektem.

\subsection{Strzelanie}\label{sec:shooting_concept}

Podstawow¹ akcj¹ wykonywan¹ przez gracza bêdzie strzelanie do przeciwników.

Gracz bêdzie celowa³ przy pomocy myszy, lufa czo³gu bêdzie obraca³a siê w kierunku rzutu myszy na jej p³aszczyznê w przestrzeni 3D.
Taka metoda sterowania da du¿¹ dok³adnoœæ celowania. Jest równie¿ stosunkowo prosta w implementacji i intuicyjna dla gracza.

Na pociski gracza nie bêdzie dzia³aæ fizyka - bêd¹ porusza³y siê jedynie w p³aszczyŸnie równoleg³ej do ziemi. Pociski bêd¹ wchodziæ w kontakt z innymi graczami oraz z obiektami umieszczonymi w poziomie.

Gracz bêdzie móg³ strzeliæ z wykorzystaniem lewego przycisku myszy. Ka¿de wciœniêcie przycisku odpowiadaæ bêdzie jednemu wystrzelonwmu pociskowi, choæ to zachowanie mo¿e ulec zmianie w czasie rozgrywki [odniesienie do rozdzia³u z kartami?].

Postaæ gracza bêdzie mia³a ograniczon¹ pojemnoœæ "magazynku". Prze³adowanie bêdzie trwa³o okreœlony czas. W przeciwieñstwie do wielu gier z podobn¹ mechanik¹, prze³adowanie nie bêdzie konsumowaæ pocisków z wiêkszej puli - gracz ma mo¿liwoœæ nieograniczonych prze³adowañ. Rol¹ tej mechaniki jest wymuszenie na graczach myœlenia taktycznego oraz zarz¹dzania zasobami.

Aby uniemo¿liwiæ nazbyt szybkie strzelanie gracz bêdzie mia³ ograniczon¹ maksymaln¹ "szybkoœæ ataku". Jest ona okreœlona jako minimalny czas pomiêdzy kolejnymi strza³ami.

Atrybuty zwi¹zane ze strzelaniem zosta³y zebrane i opisane w tabeli \ref{tab:stats_description}. 

\subsection{System zdrowia i ¿ycia}

Aby umo¿liwiæ graczom eliminacjê przeciwników wprowadzony zostanie system zdrowia. 

Ka¿d¹ rundê gracz rozpoczyna z punktami ¿ycia równymi ich maksymalnej wartoœci. W czasie rozgrywki, otrzymuj¹c obra¿enia, ta wartoœæ bêdzie zmniejszana. Gdy wartoœæ ta osi¹gnie 0, gracz zostaje wyeliminowany z aktualnej rundy.

W czasie rozgrywki ¿ywotnoœæ postaci bêdzie siê zamoistnie zwiêkszaæ, je¿eli wystarczaj¹co d³ugo nie otrzyma³ obra¿eñ. Nie mo¿e ona jednak przekroczyæ maksymalnej wartoœci.

Atrybuty postaci zwi¹zane ze zdrowiem zosta³y zebrane i opisane w tabeli \ref{tab:stats_description}.

\subsection{System rund}

Gra bêdzie podzielona na rundy. Ka¿da z rund trwa do momentu, w którym tylko jeden gracz nie bêdzie wyeliminowany. Ten gracz dostaje jeden punkt zwyciêstwa, a nastêpnie gracze przechodz¹ do kolejnej rundy. Pomiêdzy rundami nastêpuje faza wyboru kart (opisana w rozdziale \ref{sec:upgrade_cards}). Gra trwa do rundy, po której jeden z graczy osi¹gnie docelow¹ liczbê punktów zwyciêstwa.

Taki system rozgrywki prowadzi do ró¿nej liczby rund dla ró¿nej liczby graczy oraz dla ró¿nej docelowej liczby punktów. Minimaln¹ i maksymaln¹ liczbê rund mo¿na wyraziæ nastêpuj¹cymi wzorami:

$$ n - docelowa\ liczba\ punktów\ zwyciêstwa $$
$$ p - liczba\ graczy $$
$$ r_{min} - minimalna\ liczba\ rund $$
$$ r_{max} - maksymalna\ liczba\ rund $$
$$ r_{min} = n \\ $$
$$ r_{max} = p * (n-1) + 1 $$

Minimalna liczba rund to rozgrywka, w której w ka¿dej rundzie wygrywa ten sam gracz. Maksymalna liczba rund to rozgrywka, w której ka¿dy gracz wygrywa liczbê rund o jeden mniejsz¹ ni¿ docelowa, a nastêpnie jeden z graczy wygrywa rundê, tym samym wygrywaj¹c grê. Wyliczenia dla mo¿liwych liczb graczy oraz dla przyk³adowych liczb docelowych punktów zosta³y zaprezentowane w tabeli \ref{tab:round_count}.

\begin{table}
    \small
    \centering
    \caption{Liczba rund dla ró¿nej liczby graczy i docelowych punktów zwyciêstwa.}
    \label{tab:round_count}
    \begin{tabularx}{\linewidth}{|c||X|X|}
        \hline
        Liczba graczy & Liczba rund dla $n=3$ & Liczba rund dla $n=5$ \\
        \hline \hline
        2 & 3 - 5 & 5 - 9 \\
        \hline 
        3 & 3 - 7 & 5 - 13 \\
        \hline
        4 & 3 - 9 & 5 - 17 \\
        \hline
        5 & 3 - 11 & 5 - 21 \\
        \hline
        6 & 3 - 13 & 5 - 25 \\
        \hline 
    \end{tabularx}
\end{table}

W zwi¹zku ze zwiêkszeniem liczby rund znacznie zwiêkszy siê czas rozgrywki. Z tego wzglêdu dla wiêkszych liczb graczy sugerowane bêd¹ mniejsze cele punktowe, jednak nie zostan¹ one ograniczone domyœlnie; decyzja na temat liczby docelowych punktów zwyciêstwa zostanie pozostawiona hostowi.

\subsection{Atrybuty pasywne i aktywne}\label{sec:characteristics}

W celu rezprezentacji ró¿nych cech postaci gracza ka¿dy z nich ma swoje \emph{atrybuty}. Dziel¹ siê one na pasywne i aktywne.

Atrybuty pasywne reprezentowane s¹ jedynie jako wartoœci liczbowe, które wp³ywaj¹ na zwyk³e akcje wykonywane przez gracza. Ka¿da z postaci zapisuje atrybuty pasywne dotycz¹ce jej samej oraz u¿ywanych przez ni¹ pocisków. Ka¿dy z graczy ma sta³y zbiór atrybutów pasywnych.

Atrybuty aktywne to wydarzenia wywo³ywane w momencie zaistnienia innego wydarzenia. W projektowanych mechanikach jedynym wydarzeniem inicjuj¹cym jest trafienie pociskiem innego gracza lub przeszkody, jednak mo¿liwe jest wprowadzenie kolejnych w czasie rozwoju gry.

% TODO: Dodaæ planowane atrybuty aktywne (Taki glosariusz dla nastêpnych sekcji)

\begin{table}
    \small
    \centering
    \caption{Opis atrybutów postaci i pocisku}
    \label{tab:stats_description}
    \begin{tabularx}{\linewidth}{|c|c|X|}
        \hline
        Nazwa atrybutu & Kategoria & Opis\\
        \hline \hline
        Maksymalna prêdkoœæ & Ruch & Z tak¹ najwy¿sz¹ prêdkoœci¹ mo¿e poruszaæ siê postaæ gracza.\\
        \hline
        Maksymalna prêdkoœæ k¹towa & Ruch & Z tak¹ najwy¿sz¹ prêdkoœci¹ k¹tow¹ mo¿e obracaæ siê postaæ gracza.\\
        \hline
        Maksymalna ¿ywotnoœæ & Zdrowie & Tyle najwy¿ej punktów zdrowia mo¿e mieæ postaæ. \\
        \hline 
        OpóŸnienie leczenia & Zdrowie & Tyle czasu nale¿y odczekaæ od ostatnich otrzymanych obra¿eñ przed rozpoczêciem samoleczenia. \\
        \hline
        Okres leczenia & Zdrowie & Tyle czasu up³ywa miêdzy kolejnymi wydarzeniami leczenia. \\
        \hline
        Wartoœæ leczenia & Zdrowie & O tak¹ wartoœæ zwiêkszone zostanie aktualne zdrowie postaci w ka¿dym wydarzeniu leczenia.\\
        \hline
        Pojemnoœæ magazynku & Strzelanie & Tyle pocisków mo¿e wystrzeliæ gracz przed prze³adowaniem.\\
        \hline
        Czas prze³adowania & Strzelanie & Tyle czasu up³ywa pomiêdzy pocz¹tkiem a koñcem prze³adowania. \\
        \hline
        Szybkoœæ ataku & Strzelanie & Tyle czasu nale¿y odczekaæ pomiêdzy kolejnymi strza³ami. \\
        \hline
        Obra¿enia & Atrybuty pocisku & Wartoœæ o jak¹ zmniejszy siê ¿ycie trafionej pociskiem postaci. \\
        \hline
        Szybkoœæ pocisku & Atrybuty pocisku & Szybkoœæ z jak¹ przemieszcza siê pocisk. \\
        \hline
        Okres istnienia pocisku & Atrybuty pocisku & Czas, przez jaki istnieje pocisk. Po up³ywie tego czasu od utworzenia, pocisk jest usuwany.\\
        \hline
        Rozmiar & Atrybuty pocisku & Okreœla wymiary pocisku. Zwi¹zany z obra¿eniami. Skalowany jest zarówno model jak i figura kolizji. \\
        \hline
        W³aœciciel & Atrybuty pocisku & Gracz który wystrzeli³ pocisk.\\
        \hline
        Efekty przy trafieniu & Atrybuty pocisku & Wydarzenia wywo³ywane po trafieniu pociskiem w postaæ lub przeszkodê. \\
        \hline
    \end{tabularx}

\end{table}

\subsection{Karty ulepszeñ}\label{sec:upgrade_cards}

W czasie rozgrywki gracze bêd¹ otrzymywali ulepszenia wzmacniaj¹ce ich mo¿liwoœci bojowe. Te ulepszenia gracze wybieraj¹ w fazie wyboru kart, pomiêdzy rundami.

Po zakoñczeniu rundy, ka¿dy z graczy o najmniejszej liczbie punktów zwyciêstwa otrzyma zestaw losowych kart, spoœród których bêdzie musia³ wybraæ jedn¹. Wybrana karta zostaje zapisana dla tego gracza i od tej pory bêdzie dzia³a³a na jego postaæ. Po wybraniu karty przez ka¿dego z graczy nastêpuje przejœcie do kolejnej rundy.

Ulepszenia nadawane s¹ jedynie postaciom o najmniejszej liczbie punktów zwyciêstwa w celu wyrównania szans pomiêdzy graczami o ró¿nym poziomie umiejêtnoœci. Taka technika nazywana jest \emph{metod¹ gumki recepturki} (ang. \emph{rubberbanding})\cite{practical_game_design}.

Ka¿da z kart ulepszeñ modyfikuje co najmniej jeden atrybut postaci - zwiêksza lub zmniejsza wartoœæ pasywn¹ lub dodaje kolejny atrybut aktywny. Karta poprawi przynajmniej jedn¹ wartoœæ atrybutu, jednak mo¿liwe jest, ¿e pogorszy inne atrybuty aby zbalansowaæ jej dzia³anie. Wprowadza to równie¿ nieoczywist¹ decyzjê do podjêcia dla gracza (przyk³adowo: \emph{Czy warto wybraæ kartê poprawiaj¹c¹ dwukrotnie zadawane obra¿enia, ale obni¿aj¹c¹ o po³owê w³asn¹ ¿ywotnoœæ?}).

\subsubsection{Pocz¹tkowy zbiór kart}
W celu zró¿nicowania rozgrywek przygotowane zostanie 20 kart z mo¿liwoœci¹ dodania kolejnych w przysz³oœci. Planowane do zaimplementowania karty przedstawione zosta³y w tabeli \ref{tab:cards}.

\begin{table}
    \small
    \centering
    \caption{Pocz¹tkowy zbiór kart}
    \label{tab:cards}
    \begin{tabularx}{\linewidth}{|c|c|c|X|}
        \hline
        lp. & Nazwa & Nazwa angielska & Opis\\
        \hline \hline
        1 & tbc & TANK & Zwiêkszona ¿ywotnoœæ, Zmniejszona szybkoœæ \\
        \hline 
        2 & tbc & Speedy Gonzales & Zwiêkszona szybkoœæ, Zmniejszona ¿ywotnoœæ \\
        \hline 
        3 & tbc & Glass Canon & Zwiêkszone obra¿enia, Zancznie zmniejszona ¿ywotnoœæ \\
        \hline 
        4 & tbc & Cockroach & Zmniejszona ¿ywotnoœæ, zwiêkszona wartoœæ leczenia \\
        \hline 
        5 & tbc & Sniper & Zwiêkszone obra¿enia, zwiêkszona szybkoœæ kuli, zmniejszona szybkostrzelnoœæ, zmniejszona pojemnoœæ magazynka \\
        \hline 
        6 & tbc & Rubber Bullets & Dodatkowe odbicia kuli, Wyd³u¿ony czas prze³adowania\\
        \hline 
        7 & tbc & FULL AUTO & Zwiêkszona szybkostrzelnoœæ, zmniejszone obra¿enia, znacznie zwiêkszona pojemnoœæ magazynku, zwiêkszony czas prze³adowania (jeœli siê uda: Automatyczne strzelanie, nie trzeba puszczaæ przycisku strza³u, aby wykonaæ kolejny strza³) \\
        \hline 
        8 & tbc & Granade Launcher & Zmniejszone obra¿enia pocisku, zmniejszona prêdkoœæ pocisku, AKTYWNA: Przy trafieniu lub zakoñczeniu ¿ycia pocisk eksploduje, zadaj¹c obra¿enia w promieniu \\
        \hline 
        9 & tbc & Flame & Pociski podpalaj¹ trafionego gracza, zadaj¹c mu obra¿enia przez kilka sekund, Zwiêkszone obra¿enia, wyd³u¿ony czas prze³adowania \\
        \hline 
        10 & tbc & Life Steal & Trafienie przeciwnika leczy w³aœciciela o czêœæ zadanych obra¿eñ  \\
        \hline 
        11 & tbc & NUKE & Zmniejszenie pojemnoœci magazynku, Znaczne zwiêkszenie obra¿eñ, Eksplozja\\
        \hline 
        12 & tbc & Quick Reload & Znaczne zmniejszenie czasu prze³adowania \\
        \hline 
        13 & tbc & BIG BOY & Znaczne zwiêkszenie ¿ywotnoœci, Znaczne zmniejszenie wartoœci leczenia (albo zwiêkszenie czasu leczenia)  \\
        \hline 
        14 & tbc & Fragmentation & Po trafieniu przeszkody w miejscu trafienia tworzone s¹ mniejsze, s³absze pociski skierowane w losowych kierunkach (od³amki), Zwiêkszony czas prze³adowywania\\
        \hline 
        15 & tbc & Freezing Bullet & Zwiêkszony czas prze³adowania, Po trafieniu postaci zostaje ona zamro¿ona - jej szybkoœæ zostaje znacznie zmniejszona \\
        \hline 
        16 & tbc & Cowboy & Znacznie zwiêkszona szybkostrzelnoœæ, Zwiêkszone obra¿enia, Znacznie zwiêkszony czas prze³adowania \\
        \hline 
        17 & tbc & CHAOS & Znacznie wiêcej odbiæ kuli, Zmniejszone obra¿enia \\
        \hline 
        18 & tbc & Knockback & Trafiona postaæ zostaje odepchniêta w kierunku, w którym lecia³a kula \\
        \hline 
        19 & tbc & Directed Bounce & Dodatkowe jedno odbicie, Kule odbijaj¹ siê w kierunku najbli¿szego widocznego gracza, je¿eli ¿aden nie jest widoczny odbijaj¹ siê normalnie \\
        \hline 
        20 & tbc & Tactical Advantage & Trafienie przeciwnika prze³adowuje magazynek w³aœciciela, Znaczne zwiêkszenie czasu prze³adowania \\
        \hline 
    \end{tabularx}
\end{table}

\subsection{User experience}%predykcje klienckie + buforowanie akcji

W celu zapewnienia satysfakcjonuj¹cej rozgrywki zostan¹ zastosowane techniki poprawy doœwiadczenia graczy (\emph{User Experience} - UX). 

\subsubsection{Buforowanie akcji}

Buforowanie akcji odnosi siê do techniki, w której polecenia wydawane przez gracza s¹ zapisywane w przypadku gdy nie jest mo¿liwe wykonanie ich natychmiast. Akcje wywo³ywane przez te polecenia zostaj¹ aktywowane w momencie gdy nastanie taka mo¿liwoœæ. \cite{input_buffering}

W przygotowywanej grze ta technika zostanie wykorzystana dla akcji strzelania. Gdy postaæ gracza bêdzie w stanie prze³adowywania lub oczekiwania na kolejny strza³ a gracz wprowadzi polecenie strza³u zostanie ono zapisane na kilka klatek i wykonane, je¿eli w tym czasie ta akcja zostanie odblokowana. 

Zastosowanie tej techniki pozwoli unikn¹æ sytuacji, w której gracz wprowadzi polecenie tu¿ przed zmian¹ stanu. Bez buforowania akcji to polecenie zosta³oby zignorowane, co mo¿e prowadziæ do poczucia niesprawiedliwego potraktowania przez grê. Wprowadzenie buforowania sprawia, ¿e gra \emph{wydaje siê} byæ bardziej sprawiedliwa poprzez wybaczanie drobnych b³êdów gracza.

\subsubsection{Predykcje klienckie}\label{sec:concept_prediction}

W grze sieciowej nie sposób unikn¹æ opóŸnieñ zwi¹zanych z po³¹czeniem, nawet gdy komputery graczy znajduj¹ siê w tej samej sieci. Przesy³aj¹c pozycjê graczy przez sieæ opóŸnienie i utracone pakiety sprawiaj¹, ¿e postaci innych graczy wygl¹daj¹ jakby "przeskakiwa³y". W zwi¹zku z tym nale¿y wprowadziæ usprawnienia sprawiaj¹ce, ¿e te "przeskoki" nie sa widoczne. 

Taki efekt mo¿na osi¹gn¹æ na kilka sposobów. Po pierwsze, wprowadzona zostanie interpolacja pozycji i rotacji postaci. Nie bêd¹ one zmienia³y pozycji nagle, lecz bêdzie ona p³ynnie, liniowo zmieniana w czasie. Ponadto zastosowane zostan¹ predykcje klienckie - poza pozycj¹ i rotacj¹ gracza przesy³ana bêdzie równie¿ jego prêdkoœæ. W przypadku utraty wielu pakietów postaæ bêdzie nadal porusza³a siê z t¹ sam¹ prêdkoœci¹. Jest to sposób na "zgadniêcie" przysz³ych, nieznanych pozycji gracza.  

